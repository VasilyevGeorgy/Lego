import lejos.hardware.BrickFinder;
import lejos.hardware.lcd.GraphicsLCD;
import lejos.hardware.lcd.LCD;
import lejos.hardware.motor.EV3LargeRegulatedMotor;
import lejos.hardware.motor.EV3MediumRegulatedMotor;
import lejos.hardware.motor.Motor;
import lejos.hardware.port.MotorPort;
import lejos.robotics.RegulatedMotor;
import lejos.utility.Delay;

import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JFrame;

import java.awt.Dimension;
import java.io.File;

import static java.lang.System.out;
import lejos.hardware.Sound;
import lejos.hardware.sensor.EV3ColorSensor;
import lejos.hardware.port.SensorPort;
import lejos.hardware.sensor.SensorConstants;
import lejos.hardware.sensor.SensorMode;


public class EV3 {
	
	static RegulatedMotor a = new EV3LargeRegulatedMotor(MotorPort.C);
	static RegulatedMotor b = new EV3LargeRegulatedMotor(MotorPort.B);
	static RegulatedMotor c = new EV3MediumRegulatedMotor(MotorPort.A);
	
	static double l1 = 107; //mm
	static double l2 = 25; // mm
	
	// yellow field
	static double[] box = {0.01, 53.8, 107.61, 161.1}; //mm  расстояние между центрами коробков
	static double jump = 89;//mm  расстояние от середины до середины междурядья
	
	
	public static void invKin(double x, double y){ // y = mm
		
		x = x + l1;
		y = y - l2;
		double d2 = -l1 + Math.sqrt(x*x +y*y -l2*l2);
		//System.out.println(d2);
		// перевести d2  градусы для medmotor: 5000 deg = 42 mm
		double angle = 5000*d2/42;
		int th3 = (int) angle; // th3 - перевод d2 в углы
		
		angle = 0.0;
		angle = Math.atan2(y,x)*180;
		System.out.println(angle);
		double alpha = Math.atan2(l2,l1+d2)*180;
		System.out.println(alpha);
		int th2 = (int) (angle + alpha);
		System.out.println(th2);
		
		 b.setSpeed(52);
		 //b.rotate(th2);
		 b.stop();
		 
		 c.setSpeed(1600); 
		 //c.rotate(-th3);
		 //System.out.println(th3);
		 c.stop();
		
	}
	
	
	public static void forKin(int m1, int m2, int m3){
		
		//RegulatedMotor a = new EV3LargeRegulatedMotor(MotorPort.A);
		 //a.backward();
		 a.setSpeed(460); 
		 //a.rotateTo(90,true);
		 a.rotate(m1);
		 a.stop();
		 
		 //RegulatedMotor b = new EV3LargeRegulatedMotor(MotorPort.B);
		 //m2 = -m2;
		 //b.backward();
		 b.setSpeed(52);
		 //b.rotateTo(50);
		 b.rotate(m2);
		 b.stop();
		 
		 //RegulatedMotor c = new EV3MediumRegulatedMotor(MotorPort.C);
		 m3 = -m3;
		 //c.backward();
		 c.setSpeed(1600); 
		 c.rotate(m3);//110 deg = 25mm, max
		 c.stop();
		
	}
		
	private static EV3ColorSensor sensor;
	public static void colorCheck(){
		
		sensor = new EV3ColorSensor(SensorPort.S1);
	    sensor.setFloodlight(false);
	    LCD.drawString("Init", 2, 2);
	    LCD.setAutoRefresh(false);
	    SensorMode brightnessSensorMode = sensor.getRGBMode();
	    float[] sample = new float[brightnessSensorMode.sampleSize()];
	    
	    int i = 0;

	    while(i < 25) {
	    	++i;
	        brightnessSensorMode.fetchSample(sample, 0);
	        LCD.refresh();
	        LCD.clear();
	        System.out.println("R: " + sample[0] + " G: " + sample[1] + " B: " + sample[2] + "\n");
	    }
		
	}
	
	public static void playSound(){
	     final File sound = new File("blacksabbath.wav");
	     Sound.playSample(sound, 300);
	     //System.out.println("still running...");
	     Delay.msDelay(1000);
	}
	
	
	public static void e5(int len){
		Sound.playNote(Sound.FLUTE, 659, len);
	}
	public static void b4(int len){
		Sound.playNote(Sound.FLUTE, 494, len);
	}
	public static void c5(int len){
		Sound.playNote(Sound.FLUTE, 523, len);
	}
	public static void d5(int len){
		Sound.playNote(Sound.FLUTE, 587, len);
	}
	public static void a4(int len){
		Sound.playNote(Sound.FLUTE, 440, len);
	}
	public static void f5(int len){
		Sound.playNote(Sound.FLUTE, 698, len);
	}
	public static void a5(int len){
		Sound.playNote(Sound.FLUTE, 880, len);
	}
	public static void g5(int len){
		Sound.playNote(Sound.FLUTE, 784, len);
	}
	
	public static void playMelody(){
		
		// Note's length
		int hex = 90; // 1/16
		int egh = 180; // 1/8
		int qrt = 360; // 1/4
		
		e5(qrt);
		b4(egh);
		c5(egh);
		d5(egh);
		e5(hex);
		d5(hex);
		c5(egh);
		b4(egh);

		a4(qrt);
		a4(egh);
		c5(egh);
		e5(qrt);
		d5(egh);
		c5(egh);

		b4(qrt+egh);
		c5(egh);
		d5(qrt);
		e5(qrt);
		
		c5(qrt);
		a4(qrt);
		a4(qrt+egh);
		Delay.msDelay(hex);
		
		d5(qrt);
		f5(egh);
		a5(egh);
		a5(hex);
		a5(hex);
		g5(egh);
		f5(egh);
		
		e5(qrt+egh);
		//Delay.msDelay(hex);
		c5(egh);
		e5(qrt);
		d5(egh);
		c5(egh);
		
		b4(qrt);
		b4(egh);
		c5(egh);
		d5(qrt);
		e5(qrt);
		
		c5(qrt);
		a4(qrt);
		a4(qrt+egh);
		Delay.msDelay(egh);
		
	}
	
	 public static void main(String[] args) {	
		 

	     
		 //forKin(0,0,-1500);// 900,...,5000 - max
		 //forKin(360,0,0);
		 //forKin(0,0,-2000);
		 
		 //GraphicsLCD g  = BrickFinder.getDefault().getGraphicsLCD(); 
		 invKin(0.0,53);
	     /*//g.drawString("First box", 0, 0, GraphicsLCD.VCENTER | GraphicsLCD.HCENTER);
	     Delay.msDelay(1000);
		 invKin(0.01,box[1]);
		 //g.drawString("Second box", 0, 0, GraphicsLCD.VCENTER | GraphicsLCD.HCENTER);
	     Delay.msDelay(1000);
	     LCD.refresh();
	     LCD.clear();
		 invKin(0.01,box[2]);
		 //g.drawString("Third box", 0, 0, GraphicsLCD.VCENTER | GraphicsLCD.HCENTER);
	     Delay.msDelay(1000);
		 invKin(0.01,box[3]);
		 //g.drawString("Fourth box", 0, 0, GraphicsLCD.VCENTER | GraphicsLCD.HCENTER);
	     Delay.msDelay(1000);*/
		 
		 //colorCheck();  
		 
		 //playSound();
		 
		 //playMelody();
		 
	     //GraphicsLCD g  = BrickFinder.getDefault().getGraphicsLCD();     
	     //g.drawString("", 0, 0, GraphicsLCD.VCENTER | GraphicsLCD.LEFT);
	     //Delay.msDelay(5000);
		 

		 //operating( 45, 45, 45);
		 
	}

}
